databaseChangeLog:
  - changeSet:
      id: 001-create-tables
      author: onecart-team
      changes:
        - createTable:
            tableName: users
            columns:
              - column: {name: id, type: BIGINT UNSIGNED AUTO_INCREMENT, constraints: { primaryKey: true, nullable: false } }
              - column: {name: username, type: VARCHAR(150), constraints: { nullable: false, unique: true } }
              - column: {name: email, type: VARCHAR(255), constraints: { nullable: false, unique: true } }
              - column: {name: password_hash, type: VARCHAR(255), constraints: { nullable: false } }
              - column: {name: mfa_secret, type: VARCHAR(64)}
              - column: {name: status, type: VARCHAR(32), constraints: { nullable: false } }
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }
              - column: {name: updated_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP }

        - createTable:
            tableName: refresh_tokens
            columns:
              - column: {name: id, type: BIGINT UNSIGNED AUTO_INCREMENT, constraints: { primaryKey: true, nullable: false } }
              - column: {name: user_id, type: BIGINT UNSIGNED, constraints: { nullable: false } }
              - column: {name: token, type: CHAR(64), constraints: { nullable: false, unique: true } }
              - column: { name: expires_at, type: TIMESTAMP, constraints: { nullable: false } }
              - column: { name: created_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }

        - addForeignKeyConstraint:
            baseTableName: refresh_tokens
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_refresh_tokens_users

        - createTable:
            tableName: audit_log
            columns:
              - column: { name: id, type: BIGINT UNSIGNED AUTO_INCREMENT, constraints: { primaryKey: true, nullable: false } }
              - column: { name: user_id, type: BIGINT UNSIGNED }
              - column: { name: event_type, type: VARCHAR(64), constraints: { nullable: false } }
              - column: { name: details, type: VARCHAR(1000) }
              - column: { name: created_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }